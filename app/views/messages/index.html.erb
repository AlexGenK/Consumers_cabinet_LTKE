<%= render './consumers/card', consumer: @consumer, manager: @manager, style: params[:cab]%>
<br>
<% if params[:cab] == 'gas' %>
  <%= render './gastab', active: 4 %>
<% else %>
  <%= render './entab', active: 4 %>
<% end %>
<br>
<%= form_for [@consumer, @message] do |f| %>
  <div class="form-group row">
    <div class="col-sm-2">
      <%= f.label :text, "Введить запит:", class: "col-form-label" %>
    </div>
    <div class="col-sm-10">
      <%= f.text_area :text, class: "form-control" %>
    </div>
  </div>
  <div class="form-group row">
    <div class="col-sm-2">
    </div>
    <div class="col-sm-10">
      <%= f.button type: 'submit', name: 'cab', value: params[:cab], class: "btn btn-outline-dark" do %>
        <i class="fas fa-share-square"></i> Надіслати
      <% end %>
    </div>
  </div>
<% end %>
<h6>Історія запитів</h6>
<div class="row block-v-scroll">
  <div class="col-md">
    <table class="table table-striped table-sm">
      <thead>
        <th class="text-center">Дата</th>
        <th>Запит</th>
        <th class="text-center">Статус</th>
        <th>Коментар</th>
        <th></th>
      </thead>
      <tbody>
        <% @messages.each do |message| %>
          <tr>
            <td class="text-center"><%= message.created_at.strftime('%d.%m.%Y') %></td>
            <td><%= truncate(message.text, length: 60) %></td>
            <td class="text-center">
              <% case message.state %>
              <% when 0 %>
                <span class="badge badge-light">Відправлено</span>
              <% when 1 %>
                <span class="badge badge-primary">Прийнято</span>
              <% when 2 %>
                <span class="badge badge-success">Виконано</span>
              <% when 3 %>
                <span class="badge badge-danger">Не виконано</span>
              <% end %>              
            </td>
            <td><%= truncate(message.comment, length: 25) %></td>
            <td class='text-right'>
              <div class="btn-group">
              <%= link_to edit_consumer_message_path(@consumer, message, cab: params[:cab]), 
                class: "btn btn-outline-dark btn-sm" do %>
                <i class="fas fa-edit test-edit-message"></i>
              <% end %>
              <%= link_to [@consumer, message, cab: params[:cab]], method: :delete, 
                class: "btn btn-outline-danger btn-sm",
                data: {confirm: "Ви впевнені що хочете видалити запит?"} do %>
                <i class="fas fa-times test-delete-message">&nbsp</i>
              <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
